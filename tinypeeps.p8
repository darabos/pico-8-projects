pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
function _init()
 over=false
 target_score=1000
 score=0
 start_time=time()

	e={}
	s={4,9,15}
	for i=1,1000 do
	 m=2
	 p={
	  x=rnd()*64,
	  y=rnd()*64,
	  c=flr(rnd()*(15-m))+m,
	  s=s[flr(rnd()*3+1)],
	  vx=rnd()-0.5,
	  vy=rnd()-0.5,  
	 }
	 if (p.c==5) p.c=m
	 add(e,p)
	end
end

function minskydisc(x,y,r,c)
 r*=0.705
 local j,k,rat=r,r,0.5/r
 for i=1,r*5 do
  k=k-rat*j
  j=j+rat*k
  rectfill(x-j,y-k,x+j,y-k,c)
  rectfill(x-j,y+k,x+j,y+k,c)
 end
end

function _draw()
 cls(5)
 camera(-32,-32)
 minskydisc(32,32,16.5,13)
 minskydisc(32,32,16,15)
 foreach(e, function(p)
  pset(p.x,p.y,p.s)
  pset(p.x,p.y+1,p.c)
 end)
 if (not over) spr(2,mx-4,my-4)
 line(0,0,63*(score/target_score),0,7)
 camera()
 print(score,10,10,7)
 rectfill(0,0,127,31,0)
 rectfill(0,96,127,127,0)
 rectfill(0,32,31,96,0)
 rectfill(96,32,127,96,0)
 if over or mx<0 or mx>=64 or my<0 or my>=64 then
  pset(mx+32,my+32,7)
 end
 
 if over then
  local t=2*(finish_time-start_time)
  t='time: '..t
  print(t,40,61,0)
  print(t,42,61,0)
  print(t,41,60,0)
  print(t,41,62,0)
  print(t,41,61,7)
 end
end
poke(0x5f2d, 3)

function _update60()
 mx=stat(32)-32
 my=stat(33)-32
 if over then
  if btnp(❎) then
   _init()
  end
  return
 end
 local scare=0.5
 if btnp(❎) then
  sfx(flr(rnd()*3))
  scare=10
 end
 foreach(e, function(p)
  local dx=mx-p.x
  local dy=my-p.y
  local d2=dx*dx+dy*dy
  p.vx+=scare*dx/d2
  p.vy+=scare*dy/d2
  p.x-=p.vx*0.1
  p.y-=p.vy*0.1
  p.x=mid(0,p.x,63)
  p.y=mid(0,p.y,62)
  dx=p.x-32
  dy=p.y-32
  d2=dx*dx+dy*dy
  p.capture=d2<256
  if (p.capture) score+=0.01
  if (p.x==0) p.vx=abs(p.vx)*0.5
  if (p.x==63) p.vx=-abs(p.vx)*0.5
  if (p.y==0) p.vy=abs(p.vy)*0.5
  if (p.y==62) p.vy=-abs(p.vy)*0.5
  if rnd()<0.1 then
   p.vx+=rnd()-0.5
   p.vy+=rnd()-0.5
  end
 end)
 if score>=target_score then
  over=true
  finish_time=time()
 end
end

__gfx__
00000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000000880033b300300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000f0f07700333303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000020c07700003330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000003030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000003030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000e12014140181501b1701c1701c1701c1701b15018150141500e1500a1500515003150031500315002150021400214002130021300112001120011100111000100001000010000100001000010000100
000100001012014140191501d170231702717027170241501e15016150101500c1500a1500a150031500315002150021400214002130021300112001120011100111000100001000010000100001000010000100
00010000071200c1400f150121701417017170191701b1501b1501c1501c1501c1501c1501c1501b15018150131601316012150111500f1400e1400c1400b1300b1300b1300a1200812006120051200212001110
